"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const withoutGlobal = (rx) => new RegExp(rx, rx.flags.replace('g', ''));
const stringMatcher = (str) => (message) => message.text === str;
const regExpMatcher = (rx) => (message) => withoutGlobal(rx).test(message.text);
const normalizeMatcher = (matcher) => {
    if (typeof matcher === 'function')
        return matcher;
    else if (matcher instanceof RegExp)
        return regExpMatcher(matcher);
    else if (typeof matcher === 'string')
        return stringMatcher(matcher);
    else
        throw new Error(`Don't know how to match messages with ${matcher}.`);
};
class Binder {
    constructor(_bot, _matcher) {
        this._bot = _bot;
        this._matcher = _matcher;
    }
    static for(bot) {
        return (matcher) => new Binder(bot, matcher);
    }
    say(message) {
        const match = normalizeMatcher(this._matcher);
        const handler = (msg, bot) => bot.say(msg.channel, message);
        this._bot._performerHandlers.push({ match, handler });
        return this._bot;
    }
    do(handler) {
        const match = normalizeMatcher(this._matcher);
        this._bot._performerHandlers.push({ match, handler });
        return this._bot;
    }
    talk(handler) {
        const match = normalizeMatcher(this._matcher);
        this._bot._dialogHandlers.push({ match, handler });
        return this._bot;
    }
}
exports.Binder = Binder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmluZGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JpbmRlci50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQU9BLE1BQU0sYUFBYSxHQUFHLENBQUMsRUFBVSxLQUMvQixJQUFJLE1BQU0sQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLEtBQUssQ0FBQyxPQUFPLENBQUMsR0FBRyxFQUFFLEVBQUUsQ0FBQyxDQUFDLENBQUE7QUFFM0MsTUFBTSxhQUFhLEdBQUcsQ0FBQyxHQUFXLEtBQ2hDLENBQUMsT0FBb0IsS0FBSyxPQUFPLENBQUMsSUFBSSxLQUFLLEdBQUcsQ0FBQTtBQUVoRCxNQUFNLGFBQWEsR0FBRyxDQUFDLEVBQVUsS0FDL0IsQ0FBQyxPQUFvQixLQUFLLGFBQWEsQ0FBQyxFQUFFLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLElBQUksQ0FBQyxDQUFBO0FBRWhFLE1BQU0sZ0JBQWdCLEdBQUcsQ0FBQyxPQUFtQjtJQUMzQyxFQUFFLENBQUMsQ0FBQyxPQUFPLE9BQU8sS0FBSyxVQUFVLENBQUM7UUFBQyxNQUFNLENBQUMsT0FBTyxDQUFBO0lBQ2pELElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQyxPQUFPLFlBQVksTUFBTSxDQUFDO1FBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUNqRSxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUMsT0FBTyxPQUFPLEtBQUssUUFBUSxDQUFDO1FBQUMsTUFBTSxDQUFDLGFBQWEsQ0FBQyxPQUFPLENBQUMsQ0FBQTtJQUNuRSxJQUFJO1FBQUMsTUFBTSxJQUFJLEtBQUssQ0FBQyx5Q0FBeUMsT0FBTyxHQUFHLENBQUMsQ0FBQTtBQUMzRSxDQUFDLENBQUE7QUFFRDtJQUtFLFlBQW9CLElBQU8sRUFBVSxRQUFvQjtRQUFyQyxTQUFJLEdBQUosSUFBSSxDQUFHO1FBQVUsYUFBUSxHQUFSLFFBQVEsQ0FBWTtJQUFJLENBQUM7SUFKOUQsTUFBTSxDQUFDLEdBQUcsQ0FBZ0IsR0FBTTtRQUM5QixNQUFNLENBQUMsQ0FBQyxPQUFtQixLQUFLLElBQUksTUFBTSxDQUFJLEdBQUcsRUFBRSxPQUFPLENBQUMsQ0FBQTtJQUM3RCxDQUFDO0lBSUQsR0FBRyxDQUFDLE9BQTZCO1FBQy9CLE1BQU0sS0FBSyxHQUFHLGdCQUFnQixDQUFDLElBQUksQ0FBQyxRQUFRLENBQUMsQ0FBQTtRQUM3QyxNQUFNLE9BQU8sR0FBRyxDQUFDLEdBQWdCLEVBQUUsR0FBTSxLQUFLLEdBQUcsQ0FBQyxHQUFHLENBQUMsR0FBRyxDQUFDLE9BQU8sRUFBRSxPQUFPLENBQUMsQ0FBQTtRQUMzRSxJQUFJLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLElBQUksQ0FBQyxFQUFFLEtBQUssRUFBRSxPQUFPLEVBQUUsQ0FBQyxDQUFBO1FBQ3JELE1BQU0sQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFBO0lBQ2xCLENBQUM7SUFFRCxFQUFFLENBQUMsT0FBOEM7UUFDL0MsTUFBTSxLQUFLLEdBQUcsZ0JBQWdCLENBQUMsSUFBSSxDQUFDLFFBQVEsQ0FBQyxDQUFBO1FBQzdDLElBQUksQ0FBQyxJQUFJLENBQUMsa0JBQWtCLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDckQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUE7SUFDbEIsQ0FBQztJQUVELElBQUksQ0FBQyxPQUEyQztRQUM5QyxNQUFNLEtBQUssR0FBRyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDN0MsSUFBSSxDQUFDLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxDQUFDLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLENBQUE7UUFDbEQsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUE7SUFDbEIsQ0FBQztDQUNGO0FBekJELHdCQXlCQyJ9