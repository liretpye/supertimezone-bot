"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const resolvable_1 = require("../resolvable");
const action_1 = require("./action");
class Parse extends action_1.Action {
    constructor(parser, onFailure) {
        super(onFailure);
        this._resolvable = new resolvable_1.Resolvable();
        if (typeof parser !== 'function') {
            this._parse = parser.parse;
            this._isValid = parser.isValid;
        }
        else
            this._parse = parser;
    }
    perform(message) {
        const parsed = this._parse(message.text);
        const isValid = this._isValid(parsed);
        if (isValid || !this.hasFailureHandler)
            this._resolvable.resolve(parsed);
        return isValid ? true : !this.hasFailureHandler;
    }
    get promise() {
        return this._resolvable.promise;
    }
    _isValid(parsed) {
        return parsed != null;
    }
}
exports.Parse = Parse;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGFyc2UuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi9zcmMvYWN0aW9ucy9wYXJzZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLDhDQUEwQztBQUMxQyxxQ0FBaUQ7QUFHakQsV0FBNEIsU0FBUSxlQUFNO0lBSXhDLFlBQVksTUFBb0IsRUFBRSxTQUEwQjtRQUMxRCxLQUFLLENBQUMsU0FBUyxDQUFDLENBQUE7UUFKUixnQkFBVyxHQUFHLElBQUksdUJBQVUsRUFBSyxDQUFBO1FBS3pDLEVBQUUsQ0FBQyxDQUFDLE9BQU8sTUFBTSxLQUFLLFVBQVUsQ0FBQyxDQUFDLENBQUM7WUFDakMsSUFBSSxDQUFDLE1BQU0sR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFBO1lBQzFCLElBQUksQ0FBQyxRQUFRLEdBQUcsTUFBTSxDQUFDLE9BQU8sQ0FBQTtRQUNoQyxDQUFDO1FBQUMsSUFBSTtZQUFDLElBQUksQ0FBQyxNQUFNLEdBQUcsTUFBTSxDQUFBO0lBQzdCLENBQUM7SUFFRCxPQUFPLENBQUMsT0FBb0I7UUFDMUIsTUFBTSxNQUFNLEdBQUcsSUFBSSxDQUFDLE1BQU0sQ0FBQyxPQUFPLENBQUMsSUFBSSxDQUFDLENBQUE7UUFDeEMsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFFBQVEsQ0FBQyxNQUFNLENBQUMsQ0FBQTtRQUNyQyxFQUFFLENBQUMsQ0FBQyxPQUFPLElBQUksQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUM7WUFDckMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDbEMsTUFBTSxDQUFDLE9BQU8sR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsaUJBQWlCLENBQUE7SUFDakQsQ0FBQztJQUVELElBQUksT0FBTztRQUNULE1BQU0sQ0FBQyxJQUFJLENBQUMsV0FBVyxDQUFDLE9BQU8sQ0FBQTtJQUNqQyxDQUFDO0lBRVMsUUFBUSxDQUFDLE1BQVM7UUFDMUIsTUFBTSxDQUFDLE1BQU0sSUFBSSxJQUFJLENBQUE7SUFDdkIsQ0FBQztDQUNGO0FBM0JELHNCQTJCQyJ9